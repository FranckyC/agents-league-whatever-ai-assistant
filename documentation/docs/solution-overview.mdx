---
sidebar_position: 2
---

import Architecture from './img/architecture.png';
import Workflow from './img/workflow_run.png';

# Solution overview

<div className="text-center my-6">
  <p className="text-lg text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-cyan-500 font-medium">
    A multi-agent architecture built entirely on the Microsoft stack ‚Äî from Teams to SharePoint, powered by Azure AI Foundry.
  </p>
</div>

---

## Architecture

<div className='flex justify-center items-center my-6'>
    <img className="w-[85%] rounded-lg shadow-lg" src={Architecture} />
</div>

:::info 100% Microsoft stack
This architecture relies entirely on the Microsoft stack ‚Äî Azure AI Foundry, Microsoft Graph, SharePoint, Microsoft Teams and Microsoft 365 Copilot.
:::

---

## Data flow

<div className="space-y-6 my-6">

<div className="border border-purple-200 dark:border-purple-800 rounded-lg p-5">
    <p className="font-semibold text-lg mb-2">‚ë† Conversation start</p>
    <p className="text-sm mb-0">The user opens a new session with the agent through <strong>Microsoft 365 Copilot Chat</strong> or <strong>Microsoft Teams</strong>.</p>
</div>

<div className="border border-purple-200 dark:border-purple-800 rounded-lg p-5">
    <p className="font-semibold text-lg mb-2">‚ë° Authentication & consent</p>
    <p className="text-sm mb-0">The message is routed to the workflow agent in Azure AI Foundry. If this is the user's first interaction, the MCP server triggers a <strong>consent flow</strong> to authenticate the user. Authentication is handled externally by the Foundry Agent Service using OAuth.</p>
    <p className="text-xs italic mt-2 mb-0 opacity-70">Note: there is currently no technical mechanism to programmatically detect authentication success.</p>
</div>

<div className="border border-purple-200 dark:border-purple-800 rounded-lg p-5">
    <p className="font-semibold text-lg mb-2">‚ë¢ Intent classification & routing</p>
    <p className="text-sm mb-3">Once authenticated, the user continues the conversation in Copilot or Teams. The original question is sent to the <strong>workflow agent</strong>, which starts with the <strong>router agent</strong>. The router classifies the user's intent and forwards the question to the appropriate specialized agent:</p>
    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div className="bg-purple-50 dark:bg-purple-900/20 rounded-md p-3">
            <p className="font-medium text-sm mb-1">üñ•Ô∏è IT Agent</p>
            <p className="text-xs mb-0">IT policy-related questions</p>
        </div>
        <div className="bg-purple-50 dark:bg-purple-900/20 rounded-md p-3">
            <p className="font-medium text-sm mb-1">üìã HR Agent</p>
            <p className="text-xs mb-0">HR policy-related questions</p>
        </div>
        <div className="bg-purple-50 dark:bg-purple-900/20 rounded-md p-3">
            <p className="font-medium text-sm mb-1">üõ°Ô∏è Fallback Agent</p>
            <p className="text-xs mb-0">Anything outside IT or HR scope</p>
        </div>
    </div>

    <div className='flex justify-center items-center my-6'>
        <img className="w-full rounded-lg shadow-lg" src={Workflow} />
    </div>

    <p className="text-sm mt-3 mb-0">Each agent has specific instructions and parameters. For instance, HR and IT agents search for information in different SharePoint paths, and only the IT agent has the ability to submit tickets.</p>
</div>

<div className="border border-purple-200 dark:border-purple-800 rounded-lg p-5">
    <p className="font-semibold text-lg mb-2">‚ë£ Knowledge retrieval & ticket submission</p>
    <p className="text-sm mb-0">The IT or HR agent calls the <code>copilot_retrieval</code> tool to search for relevant policy documents in <strong>SharePoint</strong>. The agent then answers the question grounded in the retrieved content. If no verified answer is found, the <strong>IT agent</strong> proactively offers to raise a support ticket. If the user accepts (or directly requests one), the agent calls the <code>submit_ticket</code> tool to create a ticket in a <strong>SharePoint list</strong>.</p>
</div>

<div className="border border-purple-200 dark:border-purple-800 rounded-lg p-5">
    <p className="font-semibold text-lg mb-2">‚ë§ Secure, delegated access via Microsoft Graph</p>
    <p className="text-sm mb-0">All tool calls leverage the <strong>Microsoft Graph API</strong> ‚Äî either through the Copilot Retrieval API for document search, or through SharePoint REST APIs for ticket creation. Thanks to the <strong>OAuth Identity Passthrough</strong> feature, every operation is executed on behalf of the authenticated user with a proper Bearer token issued by the Agent Service to the MCP server. The tool output is then returned to the agent, which uses it to deliver the final answer or confirm the ticket submission.</p>
</div>

</div>
